# 现代战舰模板配置工具使用说明

## 工具简介

这是一个专为现代战舰游戏设计的傻瓜式模板配置工具，可以自动化解决不同分辨率设备的模板兼容性问题。

## 功能特点

- 🎯 **三步式配置流程** - 简单直观的步骤引导
- 📱 **自动设备检测** - 自动识别连接的Android设备
- 📸 **一键截图配置** - 自动截取关键区域，手动框选特定按钮
- 🔄 **自动代码更新** - 直接更新warship_auto_battle.py中的坐标配置
- 💾 **自动备份** - 配置前自动备份原有模板文件

## 系统要求

- Python 3.7+
- PyQt5
- OpenCV (cv2)
- ADB工具
- 已连接的Android设备（开启USB调试）

## 安装依赖

```bash
pip install PyQt5 opencv-python numpy
```

## 使用步骤

### 1. 启动工具

双击 `启动模板配置工具.bat` 或运行：
```bash
python template_config_tool.py
```

### 2. 选择设备

- 工具启动后会自动检测连接的设备
- 在下拉框中选择要配置的设备
- 如果没有显示设备，点击"刷新设备"按钮

### 3. 步骤1：主界面配置

**目标**：配置游戏主界面识别和进入战斗按钮

**操作流程**：
1. 确保游戏处于主界面状态
2. 点击"📸 截取当前屏幕"按钮
3. 工具会自动截取主界面识别区域 (2109, 40, 2254, 92)
4. 点击"配置进入战斗按钮"
5. 在弹出的图片选择器中拖拽选择进入战斗按钮区域
6. 点击"确认选择"完成配置

**配置结果**：
- 自动替换 `templates/main_page.png`
- 自动替换 `templates/into_battle.png`

### 4. 步骤2：混斗模式配置

**目标**：配置多队混战模式识别

**操作流程**：
1. 进入混斗模式地图
2. 等待游戏开始
3. 点击"📸 截取当前屏幕"按钮
4. 工具会自动截取混斗模式识别区域 (952, 88, 998, 153)

**配置结果**：
- 自动替换 `templates/multi_team_battle.png`

### 5. 步骤3：结算界面配置

**目标**：配置战斗结算界面和奖励区域

**操作流程**：
1. 进入战斗结算界面
2. 点击"📸 截取当前屏幕"按钮
3. 工具会自动截取VIP状态检测区域 (1482, 425, 1519, 465)
4. 点击"配置胜利图标"，手动框选胜利图标区域
5. 点击"配置奖励区域"，依次框选四个奖励区域：
   - 美元基础奖励区域
   - 美元额外奖励区域
   - 黄金基础奖励区域
   - 黄金额外奖励区域

**配置结果**：
- 自动替换 `templates/no_vip.png`
- 自动替换 `templates/shengli.png`
- 自动更新 `warship_auto_battle.py` 中的 `REWARD_REGIONS` 坐标

### 6. 完成配置

所有步骤完成后：
1. 点击"完成配置"按钮
2. 工具会自动备份原有模板到 `templates/backup_时间戳/` 目录
3. 显示配置完成信息
4. 清理临时文件

## 界面说明

### 主窗口

```
┌─────────────────────────────────────────────────────────────┐
│                    现代战舰模板配置工具                        │
├─────────────────────────────────────────────────────────────┤
│ 设备选择: [设备下拉框] [刷新设备]                             │
├─────────────────────────────────────────────────────────────┤
│ 配置步骤: [1.主界面配置] → [2.混斗模式配置] → [3.结算界面配置] │
├─────────────────────────────────────────────────────────────┤
│                       步骤配置区域                           │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ [上一步] [下一步] [完成配置]                                  │
└─────────────────────────────────────────────────────────────┘
```

### 图片选择器

当需要手动框选区域时，会弹出图片选择器：

- **拖拽选择**：在图片上按住鼠标左键拖拽选择区域
- **绿色框线**：显示当前选择的区域
- **确认选择**：选择完成后点击"确认选择"按钮
- **取消操作**：点击"取消"按钮放弃当前选择

## 配置文件说明

### 自动配置的区域

| 区域名称 | 坐标范围 | 说明 |
|---------|---------|------|
| 主界面识别 | (2109, 40, 2254, 92) | 用于识别游戏主界面状态 |
| 混斗模式识别 | (952, 88, 998, 153) | 用于识别多队混战模式 |
| VIP状态检测 | (1482, 425, 1519, 465) | 用于检测是否为VIP用户 |

### 手动配置的区域

| 区域名称 | 说明 |
|---------|------|
| 进入战斗按钮 | 主界面的进入战斗按钮位置 |
| 胜利图标 | 战斗结算界面的胜利标识 |
| 美元基础奖励 | 基础美元奖励数字区域 |
| 美元额外奖励 | VIP额外美元奖励数字区域 |
| 黄金基础奖励 | 基础黄金奖励数字区域 |
| 黄金额外奖励 | VIP额外黄金奖励数字区域 |

## 故障排除

### 常见问题

1. **设备未检测到**
   - 检查USB调试是否开启
   - 检查ADB驱动是否正确安装
   - 尝试重新连接设备
   - 点击"刷新设备"按钮

2. **截图失败**
   - 确保设备保持连接
   - 检查设备是否锁屏
   - 重新启动ADB服务

3. **图片选择器无法显示**
   - 检查截图文件是否存在
   - 确保有足够的磁盘空间
   - 检查图片文件是否损坏

4. **配置保存失败**
   - 检查templates目录权限
   - 确保磁盘空间充足
   - 检查文件是否被其他程序占用

### 错误代码

- **设备连接错误**：检查ADB连接和USB调试设置
- **文件保存错误**：检查目录权限和磁盘空间
- **图片处理错误**：检查OpenCV库是否正确安装
- **代码更新错误**：检查warship_auto_battle.py文件权限

## 高级功能

### 批量配置

工具支持为多个设备配置模板：
1. 配置完一个设备后
2. 更换设备重新进行配置
3. 每个设备的配置会独立保存

### 配置备份

每次配置前会自动创建备份：
- 备份目录：`templates/backup_YYYYMMDD_HHMMSS/`
- 备份文件：原有的所有模板文件
- 恢复方法：手动将备份文件复制回templates目录

### 配置验证

工具会在每个步骤完成后进行验证：
- 检查模板文件是否成功保存
- 验证坐标区域是否有效
- 确认代码更新是否成功

## 技术说明

### 文件结构

```
AgentScript/
├── template_config_tool.py          # 主程序
├── 启动模板配置工具.bat             # 启动脚本
├── 模板配置工具使用说明.md          # 使用说明
├── templates/                       # 模板目录
│   ├── main_page.png               # 主界面模板
│   ├── into_battle.png             # 进入战斗按钮
│   ├── multi_team_battle.png       # 混斗模式模板
│   ├── shengli.png                 # 胜利图标
│   ├── no_vip.png                  # 非VIP状态
│   └── backup_*/                   # 备份目录
└── warship_auto_battle.py          # 自动战斗脚本（会被更新）
```

### 核心技术

- **PyQt5**：图形界面框架
- **OpenCV**：图像处理和模板匹配
- **ADB**：Android设备通信
- **正则表达式**：代码自动更新

### 安全考虑

- 配置前自动备份原有文件
- 原子性文件操作避免损坏
- 异常处理确保程序稳定性
- 临时文件自动清理

## 更新日志

### v1.0.0 (2025-01-11)
- 初始版本发布
- 实现三步式配置流程
- 支持自动区域截取和手动区域选择
- 自动代码更新功能
- 完整的错误处理和用户反馈

## 支持与反馈

如有问题或建议，请通过以下方式联系：
- 项目地址：https://github.com/MatthewHA233/modern-warship-market
- 问题反馈：在GitHub项目中提交Issue

## 许可证

本工具遵循MIT许可证，仅供学习和研究使用。